# Debian Preseed 配置示例
# 此文件仅供参考，实际使用中由 NodeFoundry 动态生成
# 动态生成的 preseed 文件会根据节点 MAC 地址调整主机名和服务器地址

# 本地化设置
d-i debian-installer/locale string en_US
d-i keyboard-configuration/xkb-keymap select us

# 网络配置
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string node-XXXXXXXXXXXX
d-i netcfg/get_domain string

# 镜像配置
d-i mirror/country string manual
d-i mirror/http/hostname string mirrors.ustc.edu.cn
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string

# 时区和时钟
d-i time/zone string Asia/Shanghai
d-i clock-setup/utc-auto boolean true
d-i clock-setup/utc boolean true

# 分区配置
d-i partman-auto/method string regular
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman-lvm/confirm boolean true
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

# 软件包选择
d-i pkgsel/upgrade select none
tasksel tasksel/first multiselect standard, ssh-server
d-i pkgsel/include string curl mosquitto-clients

# GRUB 引导器
d-i grub-installer/only_debian boolean true
d-i grub-installer/with_other_os boolean true
d-i grub-installer/bootdev string default

# 安装完成
d-i finish-install/reboot_in_progress note

# ==================== 自定义说明 ====================
#
# 1. 主机名自动设置:
#    - 格式: node-<MAC地址> (如 node-aabbccddeeff)
#    - 可通过 API 更新节点的 Hostname 字段来覆盖
#
# 2. 网络配置:
#    - 如果 DHCP 分配了固定 IP，系统将使用静态网络配置
#    - 如果无固定 IP，系统将使用 DHCP 自动获取 IP
#    - 静态配置包括: IP, Netmask, Gateway, DNS
#
# 3. Agent 自动安装:
#    - late_command 会从 NodeFoundry 服务器下载并安装 agent
#    - Agent 二进制: http://<NF_SERVER_ADDR>/agent/nodefoundry-agent (ARM64)
#    - systemd 服务: http://<NF_SERVER_ADDR>/agent/nodefoundry-agent.service
#    - 环境配置文件: /etc/default/nodefoundry-agent
#      * NF_MAC: 自动检测 DHCP 网卡的 MAC 地址
#      * NF_MQTT_BROKER: MQTT 服务器地址 (默认: <NF_SERVER_IP>:1883)
#      * NF_LOG_LEVEL: 日志级别 (默认: info)
#      * NF_HEARTBEAT_INTERVAL: 心跳间隔秒数 (默认: 30)
#
# 4. Agent 功能:
#    - 状态上报: 发布到 MQTT 主题 node/<MAC>/status
#    - 心跳维持: 每 30 秒发送一次心跳
#    - 命令执行: 订阅 node/<MAC>/command，支持 reboot 命令
#    - 自动启动: 通过 systemd 服务在网络就绪后启动
#
# 5. 自定义 late_command:
#    如需在 preseed 中添加自定义安装脚本，可以修改
#    internal/ipxe/preseed.go 中的 generateLateCommand 方法
#
# 6. 分区方案:
#    默认使用常规分区方案（partman-auto/method=regular）
#    其他可选: lvm (使用 LVM), crypto (加密分区)
#
# 7. 软件包:
#    默认安装: curl, mosquitto-clients
#    可在 pkgsel/include 中添加更多包
# ===================================================
